"use strict";Object.defineProperty(exports, "__esModule", {value: true}); function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }var J=Object.create;var O=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var z=Object.getOwnPropertyNames;var Q=Object.getPrototypeOf,X=Object.prototype.hasOwnProperty;var j=(e,s)=>()=>(s||e((s={exports:{}}).exports,s),s.exports),Z=(e,s)=>{for(var t in s)O(e,t,{get:s[t],enumerable:!0})},K=(e,s,t,o)=>{if(s&&typeof s=="object"||typeof s=="function")for(let a of z(s))!X.call(e,a)&&a!==t&&O(e,a,{get:()=>s[a],enumerable:!(o=W(s,a))||o.enumerable});return e};var Y=(e,s,t)=>(t=e!=null?J(Q(e)):{},K(s||!e||!e.__esModule?O(t,"default",{value:e,enumerable:!0}):t,e));var T=j((be,P)=>{"use strict";var k=Object.getOwnPropertySymbols,re=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;function ne(e){if(e==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function se(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de",Object.getOwnPropertyNames(e)[0]==="5")return!1;for(var s={},t=0;t<10;t++)s["_"+String.fromCharCode(t)]=t;var o=Object.getOwnPropertyNames(s).map(function(l){return s[l]});if(o.join("")!=="0123456789")return!1;var a={};return"abcdefghijklmnopqrst".split("").forEach(function(l){a[l]=l}),Object.keys(Object.assign({},a)).join("")==="abcdefghijklmnopqrst"}catch (e2){return!1}}P.exports=se()?Object.assign:function(e,s){for(var t,o=ne(e),a,l=1;l<arguments.length;l++){t=Object(arguments[l]);for(var c in t)re.call(t,c)&&(o[c]=t[c]);if(k){a=k(t);for(var p=0;p<a.length;p++)te.call(t,a[p])&&(o[a[p]]=t[a[p]])}}return o}});var V=j((Ae,x)=>{"use strict";x.exports=oe;x.exports.append=L;var ae=/^[!#$%&'*+\-.^_`|~0-9A-Za-z]+$/;function L(e,s){if(typeof e!="string")throw new TypeError("header argument is required");if(!s)throw new TypeError("field argument is required");for(var t=Array.isArray(s)?s:N(String(s)),o=0;o<t.length;o++)if(!ae.test(t[o]))throw new TypeError("field argument contains an invalid header name");if(e==="*")return e;var a=e,l=N(e.toLowerCase());if(t.indexOf("*")!==-1||l.indexOf("*")!==-1)return"*";for(var c=0;c<t.length;c++){var p=t[c].toLowerCase();l.indexOf(p)===-1&&(l.push(p),a=a?a+", "+t[c]:t[c])}return a}function N(e){for(var s=0,t=[],o=0,a=0,l=e.length;a<l;a++)switch(e.charCodeAt(a)){case 32:o===s&&(o=s=a+1);break;case 44:t.push(e.substring(o,s)),o=s=a+1;break;default:s=a+1;break}return t.push(e.substring(o,s)),t}function oe(e,s){if(!e||!e.getHeader||!e.setHeader)throw new TypeError("res argument is required");var t=e.getHeader("Vary")||"",o=Array.isArray(t)?t.join(", "):String(t);(t=L(o,s))&&e.setHeader("Vary",t)}});var U=j((_e,M)=>{(function(){"use strict";var e=T(),s=V(),t={origin:"*",methods:"GET,HEAD,PUT,PATCH,POST,DELETE",preflightContinue:!1,optionsSuccessStatus:204};function o(n){return typeof n=="string"||n instanceof String}function a(n,r){if(Array.isArray(r)){for(var u=0;u<r.length;++u)if(a(n,r[u]))return!0;return!1}else return o(r)?n===r:r instanceof RegExp?r.test(n):!!r}function l(n,r){var u=r.headers.origin,f=[],i;return!n.origin||n.origin==="*"?f.push([{key:"Access-Control-Allow-Origin",value:"*"}]):o(n.origin)?(f.push([{key:"Access-Control-Allow-Origin",value:n.origin}]),f.push([{key:"Vary",value:"Origin"}])):(i=a(u,n.origin),f.push([{key:"Access-Control-Allow-Origin",value:i?u:!1}]),f.push([{key:"Vary",value:"Origin"}])),f}function c(n){var r=n.methods;return r.join&&(r=n.methods.join(",")),{key:"Access-Control-Allow-Methods",value:r}}function p(n){return n.credentials===!0?{key:"Access-Control-Allow-Credentials",value:"true"}:null}function y(n,r){var u=n.allowedHeaders||n.headers,f=[];return u?u.join&&(u=u.join(",")):(u=r.headers["access-control-request-headers"],f.push([{key:"Vary",value:"Access-Control-Request-Headers"}])),u&&u.length&&f.push([{key:"Access-Control-Allow-Headers",value:u}]),f}function d(n){var r=n.exposedHeaders;if(r)r.join&&(r=r.join(","));else return null;return r&&r.length?{key:"Access-Control-Expose-Headers",value:r}:null}function h(n){var r=(typeof n.maxAge=="number"||n.maxAge)&&n.maxAge.toString();return r&&r.length?{key:"Access-Control-Max-Age",value:r}:null}function _(n,r){for(var u=0,f=n.length;u<f;u++){var i=n[u];i&&(Array.isArray(i)?_(i,r):i.key==="Vary"&&i.value?s(r,i.value):i.value&&r.setHeader(i.key,i.value))}}function B(n,r,u,f){var i=[],v=r.method&&r.method.toUpperCase&&r.method.toUpperCase();v==="OPTIONS"?(i.push(l(n,r)),i.push(p(n,r)),i.push(c(n,r)),i.push(y(n,r)),i.push(h(n,r)),i.push(d(n,r)),_(i,u),n.preflightContinue?f():(u.statusCode=n.optionsSuccessStatus,u.setHeader("Content-Length","0"),u.end())):(i.push(l(n,r)),i.push(p(n,r)),i.push(d(n,r)),_(i,u),f())}function F(n){var r=null;return typeof n=="function"?r=n:r=function(u,f){f(null,n)},function(f,i,v){r(f,function(C,G){if(C)v(C);else{var g=e({},t,G),b=null;g.origin&&typeof g.origin=="function"?b=g.origin:g.origin&&(b=function(w,A){A(null,g.origin)}),b?b(f.headers.origin,function(w,A){w||!A?v(w):(g.origin=A,B(g,f,i,v))}):v()}})}}M.exports=F})()});var _express = require('express'); var _express2 = _interopRequireDefault(_express);var S={};var _dotenv = require('dotenv'); var _dotenv2 = _interopRequireDefault(_dotenv);_dotenv2.default.config();var E={};Z(E,{default:()=>ce});var I=Y(U());var _cookieparser = require('cookie-parser'); var _cookieparser2 = _interopRequireDefault(_cookieparser);var _epact = require('epact');require('helmet');require('morgan');var ce=_epact.boot.call(void 0, ()=>[(0,I.default)(),_cookieparser2.default.call(void 0, ),_express.urlencoded.call(void 0, {extended:!0}),_express.json.call(void 0, )]);var _axios = require('axios'); var _axios2 = _interopRequireDefault(_axios);function ge(e){return!!/https?:\/{2}/.test(e)}function H(e){if(!e)return null;try{return JSON.parse(e)}catch (e3){return null}}var R=_epact.page.call(void 0, {async get(e,s){let t=e.params[0],o=H(e.query["cs-headers"]),a=H(e.query["cs-inherit-headers"]),l=H(e.query["cs-append-response-headers"]);if(!ge(t)){s.status(405).end("Invalid URL: "+t);return}let c=Object.fromEntries(Object.entries(e.query).filter(([d])=>!d.startsWith("cs-"))),p=new Headers(a===!1?void 0:e.headers);if(o)for(let[d,h]of Object.entries(o))p.append(d,h);let y=await _axios2.default.get(t,{query:c,headers:o,responseType:"arraybuffer"});if(l!==!1)for(let[d,h]of Object.entries(y.headers))d.toLowerCase()!=="host"&&s.append(d,h);s.send(Buffer.from(y.data))}});var D=_epact.page.call(void 0, {get(e,s){s.sendFile(`${__dirname}/index.html`)}});var m=_express2.default.call(void 0, );[..._epact.createBoot.call(void 0, m,S),..._epact.createBoot.call(void 0, m,E)].forEach(e=>{m.use(e)});m.use("/",_epact.createPage.call(void 0, "/api/blob/:url(*)",R).router);m.use("/",_epact.createPage.call(void 0, "/api/blob",D).router);m.use((e,s,t,o)=>{o()});var Re=m;exports.default = Re;
/*
object-assign
(c) Sindre Sorhus
@license MIT
*/
/*!
 * vary
 * Copyright(c) 2014-2017 Douglas Christopher Wilson
 * MIT Licensed
 */
module.exports = module.exports.default
